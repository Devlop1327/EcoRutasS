<div class="login-container">
  <div class="auth-shell">
    <div class="form-panel">
      <div class="login-card" [@fadeSlideInOut]>
        <header class="card-header">
          <div class="brand">
            <img class="brand-logo" src="assets/eco-icon.png" alt="EcoRutas logo" />
            <div class="brand-text header-content">
              <h1 class="card-title">EcoRutas</h1>
              <p class="card-subtitle">Recicla y valora tu ciudad</p>
            </div>
          </div>
        </header>

        <section class="card-content">
          <div class="login-grid">
            <aside class="promo-box">
              <div class="promo-inner">
                <img class="promo-logo" src="assets/eco-icon.png" alt="EcoRutas" />
                <h3>Bienvenido</h3>
                <p>Ingresa para rastrear el carro de la basura en tiempo real y sacar tus residuos a tiempo.</p>
              </div>
            </aside>
            <section class="form-box">
              <div class="mode-switch" role="tablist" aria-label="Cambiar modo">
                <button type="button" class="mode-btn" [class.active]="mode() === 'login'" (click)="switchMode('login')" role="tab" [attr.aria-selected]="mode() === 'login'">
                  <span class="icon">‚Üí</span>
                  <span>Iniciar sesi√≥n</span>
                </button>
                <button type="button" class="mode-btn" [class.active]="mode() === 'register'" (click)="switchMode('register')" role="tab" [attr.aria-selected]="mode() === 'register'">
                  <span class="icon">Ôºã</span>
                  <span>Crear cuenta</span>
                </button>
              </div>

              @if (mode() === 'login') {
                <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" autocomplete="on" class="form">
                  <label class="field full-width">
                    <span class="label">Email</span>
                    <input class="input" type="email" formControlName="email" autocomplete="email" aria-label="Correo electr√≥nico" title="Correo electr√≥nico" />
                    @if (loginForm.controls.email.errors?.['required'] && loginForm.controls.email.touched) {
                      <span class="error">El email es requerido</span>
                    }
                    @if (loginForm.controls.email.errors?.['email'] && loginForm.controls.email.touched) {
                      <span class="error">Ingresa un email v√°lido</span>
                    }
                  </label>

                  <label class="field full-width">
                    <span class="label">Contrase√±a</span>
                    <div class="password-wrap">
                      <input class="input" [type]="showPassword() ? 'text' : 'password'" formControlName="password" autocomplete="current-password" aria-label="Contrase√±a" title="Contrase√±a" />
                      <button type="button" class="password-toggle" (click)="togglePassword()" [attr.aria-label]="'Mostrar contrase√±a'" [attr.aria-pressed]="showPassword()">{{ showPassword() ? 'Ocultar' : 'Mostrar' }}</button>
                    </div>
                    @if (loginForm.controls.password.errors?.['required'] && loginForm.controls.password.touched) {
                      <span class="error">La contrase√±a es requerida</span>
                    }
                    @if (loginForm.controls.password.errors?.['minlength'] && loginForm.controls.password.touched) {
                      <span class="error">M√≠nimo 6 caracteres</span>
                    }
                  </label>

                  <div class="actions actions--inline">
                    <label class="checkbox">
                      <input type="checkbox" formControlName="remember" />
                      <span>Recu√©rdame</span>
                    </label>
                    <a class="link" routerLink="/auth/forgot">¬øOlvidaste tu contrase√±a?</a>
                  </div>

                  <div class="actions">
                    <button class="btn btn-primary" type="submit" [disabled]="loading()">
                      @if (loading()) { <span class="spinner" aria-hidden="true"></span> }
                      @else { <span>Iniciar sesi√≥n</span> }
                    </button>
                  </div>
                </form>
              } @else {
                <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" autocomplete="on" class="form">
                  <label class="field full-width">
                    <span class="label">Nombre de usuario</span>
                    <input class="input" type="text" formControlName="username" autocomplete="username" aria-label="Nombre de usuario" title="Nombre de usuario" />
                    @if (registerForm.controls.username.errors?.['required'] && registerForm.controls.username.touched) {
                      <span class="error">El nombre de usuario es requerido</span>
                    }
                    @if (registerForm.controls.username.errors?.['minlength'] && registerForm.controls.username.touched) {
                      <span class="error">M√≠nimo 3 caracteres</span>
                    }
                  </label>

                  <label class="field full-width">
                    <span class="label">Email</span>
                    <input class="input" type="email" formControlName="email" autocomplete="email" />
                    @if (registerForm.controls.email.errors?.['required'] && registerForm.controls.email.touched) {
                      <span class="error">El email es requerido</span>
                    }
                    @if (registerForm.controls.email.errors?.['email'] && registerForm.controls.email.touched) {
                      <span class="error">Ingresa un email v√°lido</span>
                    }
                  </label>

                  <label class="field full-width">
                    <span class="label">Contrase√±a</span>
                    <div class="password-wrap">
                      <input class="input" [type]="showPassword() ? 'text' : 'password'" formControlName="password" autocomplete="new-password" aria-label="Contrase√±a" title="Contrase√±a" />
                      <button type="button" class="password-toggle" (click)="togglePassword()" [attr.aria-label]="'Mostrar contrase√±a'" [attr.aria-pressed]="showPassword()">{{ showPassword() ? 'Ocultar' : 'Mostrar' }}</button>
                    </div>
                    @if (registerForm.controls.password.errors?.['required'] && registerForm.controls.password.touched) {
                      <span class="error">La contrase√±a es requerida</span>
                    }
                    @if (registerForm.controls.password.errors?.['minlength'] && registerForm.controls.password.touched) {
                      <span class="error">M√≠nimo 6 caracteres</span>
                    }
                  </label>

                  <div class="strength">
                    <div class="strength-fill" [style.width.%]="passwordStrength()" [class.weak]="passwordStrength() < 40" [class.medium]="passwordStrength() >= 40 && passwordStrength() < 70" [class.strong]="passwordStrength() >= 70"></div>
                    <span class="strength-text">
                      @if (passwordStrength() < 40) { D√©bil }
                      @else if (passwordStrength() < 70) { Media }
                      @else { Fuerte }
                    </span>
                  </div>

                  <label class="field full-width">
                    <span class="label">Rol</span>
                    <select class="select" formControlName="role">
                      @for (r of roleOptions; track r) {
                        <option [value]="r">{{ r | titlecase }}</option>
                      }
                    </select>
                  </label>

                  <div class="actions">
                    <button class="btn btn-primary" type="submit" [disabled]="loading()">
                      @if (loading()) { <span class="spinner" aria-hidden="true"></span> }
                      @else { <span>Crear cuenta</span> }
                    </button>
                  </div>
                </form>
              }

              <div class="divider"><span>o</span></div>

              <div class="actions">
                <button class="btn btn-ghost btn-google" type="button" (click)="signInWithGoogle()" [disabled]="loading()">
                  <span class="g-icon" aria-hidden="true">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M21.35 11.1H12v2.9h5.35A5.9 5.9 0 0 1 6.1 15.9a5.9 5.9 0 0 1 0-7.8 5.9 5.9 0 0 1 9.9 2.4l2.74-1.6A9 9 0 1 0 12 21a9 9 0 0 0 9.35-9.9Z" fill="#4285F4"/>
                    </svg>
                  </span>
                  <span>Continuar con Google</span>
                </button>
              </div>
            </section>
          </div>
        </section>
      </div>
    </div>
    <div class="visual-panel">
      <div class="visual-content">
        <div class="visual-icon" aria-hidden="true">üåø</div>
        <h2>EcoRutas</h2>
        <p>Rastrea el recorrido de recolecci√≥n y saca tu basura a tiempo.</p>
      </div>
    </div>
  </div>
</div>

