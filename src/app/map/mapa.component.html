<div class="map-layout">
  <aside class="side">
    <a class="back-btn" routerLink="/dashboard" aria-label="Volver al dashboard" title="Volver">
      <mat-icon class="material-symbols-rounded">arrow_back</mat-icon>
    </a>
    <h2 class="title">Rutas disponibles</h2>
    @if (loading()) {
      <div class="muted">Cargando rutas...</div>
    } @else if (error()) {
      <div class="error">{{ error() }}</div>
    } @else {
      <ul class="list">
        @for (r of rutas(); track r.id) {
          <li class="item"
              [class.selected]="selectedRutaId() === r.id"
              (click)="selectRuta(r.id)"
              title="Seleccionar ruta">
            {{ r.nombre }}
          </li>
        }
        @if (rutas().length === 0) {
          <li class="muted">Sin rutas</li>
        }
      </ul>
    }

    <h2 class="title mt">VehÃ­culos</h2>
    @if (loading()) {
      <div class="muted">Cargando...</div>
    } @else {
      <ul class="list">
        @for (v of vehiculos(); track v.id) {
          <li class="item vehicle"
              [class.selected]="selectedVehiculoId() === v.id"
              (click)="selectVehiculo(v.id)"
              title="Seleccionar vehÃ­culo">
            <span class="icon">ðŸš›</span>
            {{ v.placa || v.id }}
          </li>
        }
        @if (vehiculos().length === 0) {
          <li class="muted">Sin vehÃ­culos</li>
        }
      </ul>
    }

    <!-- Controles de conductor -->
    <div class="controls mt" appConductorOnly>
      <button class="btn btn-primary" (click)="iniciarRecorrido()"
              [disabled]="!selectedRutaId() || !selectedVehiculoId() || !!currentRecorridoId()"
              title="Iniciar recorrido">
        <span class="btn-icon">â–¶</span>
        <span>Iniciar</span>
      </button>
      <button class="btn btn-danger" (click)="finalizarRecorrido()"
              [disabled]="!currentRecorridoId()"
              title="Finalizar recorrido">
        <span class="btn-icon">â– </span>
        <span>Finalizar</span>
      </button>
      @if (currentRecorridoId()) {
        <div class="muted small status">Recorrido activo: {{ currentRecorridoId() }}</div>
      }
    </div>
  </aside>
  <section class="map-wrap">
    <div id="map" class="map"></div>
  </section>
</div>
