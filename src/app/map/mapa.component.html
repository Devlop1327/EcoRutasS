<div class="map-layout">
  <aside class="side">
    <a class="back-btn" routerLink="/dashboard" aria-label="Volver al dashboard" title="Volver">
      <span class="icon" aria-hidden="true">‚Üê</span>
    </a>
    <h2 class="title">Rutas disponibles</h2>
    @if (loading()) {
      <div class="muted">Cargando rutas...</div>
    } @else if (error()) {
      <div class="error">{{ error() }}</div>
    } @else {
      @if (rutas().length > 0) {
        <ul class="list">
          @for (r of rutas(); track r.id) {
            <li class="item"
                [class.selected]="selectedRutaId() === r.id"
                (click)="selectRuta(r.id)"
                title="Seleccionar ruta">
              {{ r.nombre }}
            </li>
          }
        </ul>
      } @else {
        <div class="muted">Sin rutas</div>
      }
    }

    <h2 class="title mt">Veh√≠culos</h2>
    @if (loading()) {
      <div class="muted">Cargando...</div>
    } @else {
      @if (vehiculos().length > 0) {
        <ul class="list">
          @for (v of vehiculos(); track v.id) {
            <li class="item vehicle"
                [class.selected]="selectedVehiculoId() === v.id"
                (click)="selectVehiculo(v.id)"
                title="Seleccionar veh√≠culo">
              <span class="icon">üöõ</span>
              {{ v.placa || v.id }}
            </li>
          }
        </ul>
      } @else {
        <div class="muted">Sin veh√≠culos</div>
      }
    }

    <!-- Controles de conductor -->
    <div class="controls mt" appConductorOnly>
      <button class="btn btn-primary" (click)="iniciarRecorrido()"
              [disabled]="!selectedRutaId() || !selectedVehiculoId() || !!currentRecorridoId()"
              title="Iniciar recorrido">
        <span class="btn-icon">‚ñ∂</span>
        <span>Iniciar Recorrido</span>
      </button>
      <button class="btn btn-danger" (click)="finalizarRecorrido()"
              [disabled]="!currentRecorridoId()"
              title="Finalizar recorrido">
        <span class="btn-icon">‚ñ†</span>
        <span>Finalizar</span>
      </button>
      @if (currentRecorridoId()) {
        <div class="muted small status">Recorrido activo: {{ currentRecorridoId() }}</div>
      }
    </div>
  </aside>
  <section class="map-wrap">
    <div id="map" class="map"></div>
  </section>
</div>
