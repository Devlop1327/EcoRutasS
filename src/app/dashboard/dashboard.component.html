<div class="dashboard" [class.dark]="theme() === 'dark'">
  <div class="layout">
    <aside class="sidebar">
      <div class="profile">
        @if (avatar()) {
          <div class="avatar"><img src="{{ avatar() }}" alt="Avatar" class="avatar-img"/></div>
        } @else {
          <div class="avatar">{{ userName().charAt(0).toUpperCase() }}</div>
        }
        <div class="profile-info">
          <div class="name">{{ userName() }}</div>
          <div class="sub">{{ role() ? (role() | titlecase) : 'Usuario' }}</div>
        </div>
      </div>

      <nav class="side-nav">
        <a routerLink="/dashboard" class="nav-item active">ğŸ“Š <span>Dashboard</span></a>
        <a routerLink="/mapa" class="nav-item">ğŸ—ºï¸ <span>Ver mapa</span></a>
        <a routerLink="/perfil" class="nav-item">âš™ï¸ <span>ConfiguraciÃ³n</span></a>
        @if (role() === 'admin') {
          <a routerLink="/admin" class="nav-item">ğŸ› ï¸ <span>Panel admin</span></a>
        }
      </nav>

      <div class="side-quick">
        <button class="btn-ghost" routerLink="/perfil">Mi perfil</button>
        <button class="btn-logout small" (click)="logout()">Cerrar Sesion</button>
      </div>
    </aside>

    <main class="main">
      <header class="topbar">
        <div class="title-block">
          <h2 class="title">{{ greeting() }}, {{ userName() }}!</h2>
          <p class="subtitle">Panel de control â€” Estado de recolecciÃ³n</p>
        </div>
        <div class="actions">
            <button class="btn-theme" (click)="toggleTheme()">
              @if (theme() === 'dark') {
                <span>ğŸŒ™</span>
              } @else {
                <span>â˜€ï¸</span>
              }
            </button>
          </div>
      </header>

      <!-- Circular stats for Admin/overview -->
      <div class="round-cards">
        <div class="round-card round-veh">
          <div class="circle"><span class="value">{{ vehiculosCount() }}</span></div>
          <div class="label">VehÃ­culos</div>
        </div>
        <div class="round-card round-rut">
          <div class="circle"><span class="value">{{ rutasCount() }}</span></div>
          <div class="label">Rutas</div>
        </div>
      </div>

      @if (loading()) {
        <div class="loading">Cargando datos...</div>
      } @else if (error()) {
        <div class="error-box">{{ error() }}</div>
      } @else {
        <div class="cards">
          <a routerLink="/mapa" class="card card-primary card-clickable card-live">
            <div class="live-badge"><span class="dot"></span> En vivo</div>
            <div class="card-icon">ğŸ—ºï¸</div>
            <div class="card-body">
              <h3 class="card-title">Mapa en vivo</h3>
              <p class="card-text">Ver rutas y vehÃ­culos en tiempo real</p>
              <div class="mini-map"><canvas #miniMap></canvas></div>
              <div class="card-action">Ir al mapa â†’</div>
            </div>
          </a>

          <div class="card">
            <div class="card-icon">ğŸš›</div>
            <div class="card-body">
              <h3 class="card-title">VehÃ­culos activos</h3>
              <p class="card-number">{{ vehiculosCount() }}</p>
              <p class="card-text">En operaciÃ³n</p>
              <div class="sparkline"><canvas #vehChart></canvas></div>
            </div>
          </div>

          <div class="card">
            <div class="card-icon">ğŸ›£ï¸</div>
            <div class="card-body">
              <h3 class="card-title">Rutas disponibles</h3>
              <p class="card-number">{{ rutasCount() }}</p>
              <p class="card-text">En Buenaventura</p>
              <div class="sparkline"><canvas #rutasChart></canvas></div>
            </div>
          </div>

          <a routerLink="/perfil" class="card card-clickable">
            <div class="card-icon">ğŸ‘¤</div>
            <div class="card-body">
              <h3 class="card-title">Mi perfil</h3>
              <p class="card-text">Configurar direcciÃ³n y preferencias</p>
              <div class="card-action">Ver perfil â†’</div>
            </div>
          </a>
        </div>

        <!-- quick actions moved to topbar; removed duplicate quick-links without links -->
      }
    </main>
  </div>
</div>
