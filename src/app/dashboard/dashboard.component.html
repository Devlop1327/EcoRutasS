<div class="dashboard" [class.dark]="theme() === 'dark'">
  <header class="header">
    <div class="header-content">
      <h1 class="logo">EcoRutas</h1>
      <div class="user-menu">
        @if (role()) {
          <span class="role-badge" [attr.data-role]="role()">{{ role() | titlecase }}</span>
        }
        <span class="user-name">{{ userName() }}</span>
        <button class="btn-theme" (click)="toggleTheme()" [attr.aria-label]="theme() === 'dark' ? 'Cambiar a claro' : 'Cambiar a oscuro'">
          @if (theme() === 'dark') { ğŸŒ™ } @else { â˜€ï¸ }
        </button>
        <button class="btn-logout" (click)="logout()">Salir</button>
      </div>
    </div>
  </header>

  <main class="main">
    <div class="hero-anim" aria-hidden="true"></div>
    <div class="status-bar">
      <span class="pulse-dot"></span>
      <span>En vivo en Buenaventura</span>
      <a routerLink="/mapa" class="status-link">Ir al mapa â†’</a>
    </div>
    <div class="welcome">
      <h2 class="title">{{ greeting() }}, {{ userName() }}!</h2>
      <p class="subtitle">Bienvenido a tu panel de control de recolecciÃ³n</p>
    </div>

    <!-- Circular stats for Admin/overview -->
    <div class="round-cards">
      <div class="round-card round-veh">
        <div class="circle"><span class="value">{{ vehiculosCount() }}</span></div>
        <div class="label">VehÃ­culos</div>
      </div>
      <div class="round-card round-rut">
        <div class="circle"><span class="value">{{ rutasCount() }}</span></div>
        <div class="label">Rutas</div>
      </div>
    </div>

    @if (loading()) {
      <div class="loading">Cargando datos...</div>
    } @else if (error()) {
      <div class="error-box">{{ error() }}</div>
    } @else {
      <div class="cards">
        <a routerLink="/mapa" class="card card-primary card-clickable card-live">
          <div class="live-badge"><span class="dot"></span> En vivo</div>
          <div class="card-icon">ğŸ—ºï¸</div>
          <div class="card-body">
            <h3 class="card-title">Mapa en vivo</h3>
            <p class="card-text">Ver rutas y vehÃ­culos en tiempo real</p>
            <div class="mini-map"><canvas #miniMap></canvas></div>
            <div class="card-action">Ir al mapa â†’</div>
          </div>
        </a>

        <div class="card">
          <div class="card-icon">ğŸš›</div>
          <div class="card-body">
            <h3 class="card-title">VehÃ­culos activos</h3>
            <p class="card-number">{{ vehiculosCount() }}</p>
            <p class="card-text">En operaciÃ³n</p>
            <div class="sparkline"><canvas #vehChart></canvas></div>
          </div>
        </div>

        <div class="card">
          <div class="card-icon">ğŸ›£ï¸</div>
          <div class="card-body">
            <h3 class="card-title">Rutas disponibles</h3>
            <p class="card-number">{{ rutasCount() }}</p>
            <p class="card-text">En Buenaventura</p>
            <div class="sparkline"><canvas #rutasChart></canvas></div>
          </div>
        </div>

        <a routerLink="/perfil" class="card card-clickable">
          <div class="card-icon">ğŸ‘¤</div>
          <div class="card-body">
            <h3 class="card-title">Mi perfil</h3>
            <p class="card-text">Configurar direcciÃ³n y preferencias</p>
            <div class="card-action">Ver perfil â†’</div>
          </div>
        </a>
      </div>

      <div class="info-section">
        <h3 class="section-title">Accesos rÃ¡pidos</h3>
        <div class="quick-links">
          <a routerLink="/mapa" class="quick-link">
            <span class="link-icon">ğŸ“</span>
            <span class="link-text">Ver mapa</span>
          </a>
          <a routerLink="/perfil" class="quick-link">
            <span class="link-icon">âš™ï¸</span>
            <span class="link-text">ConfiguraciÃ³n</span>
          </a>
          @if (role() === 'admin') {
            <a routerLink="/admin" class="quick-link">
              <span class="link-icon">ğŸ› ï¸</span>
              <span class="link-text">Panel administrativo</span>
            </a>
          }
          <a routerLink="/auth/login" class="quick-link">
            <span class="link-icon">â„¹ï¸</span>
            <span class="link-text">Ayuda</span>
          </a>
        </div>
      </div>
    }
  </main>
</div>
