<div class="rutas-page">
  <h2 class="page-title">Rutas</h2>

  <section class="actions">
    <a class="btn btn-primary" routerLink="/admin/rutas/editor">üó∫Ô∏è Crear desde mapa</a>
  </section>

  <section class="union-form">
    <details class="collapsible" open>
      <summary>
        <span class="section-title">Crear por uni√≥n de calles</span>
        <span class="caret" aria-hidden>‚ñæ</span>
      </summary>
      <form class="card" [formGroup]="unionForm" (ngSubmit)="crearPorUnion()">
        <div class="grid">
          <label class="field">
            <span class="label">Nombre de la ruta</span>
            <input class="input" type="text" formControlName="nombre_ruta" placeholder="Ruta 1">
          </label>
          <label class="field full">
            <span class="label">Calles IDs (separadas por coma o salto de l√≠nea)</span>
            <textarea class="input" rows="4" formControlName="calles_ids" placeholder="c1, c2, c3"></textarea>
          </label>
        </div>
        <div class="buttons">
          <button class="btn btn-primary" type="submit" [disabled]="loading() || unionForm.invalid">
            @if (loading()) { Creando... } @else { Crear }
          </button>
        </div>
      </form>
      @if (error()) { <div class="alert error">{{ error() }}</div> }
      @if (success()) { <div class="alert ok">{{ success() }}</div> }
    </details>
  </section>

  <section class="listado">
    <details class="collapsible" open>
      <summary>
        <span class="section-title">Listado</span>
        <span class="count">{{ rutas().length }}</span>
        <span class="caret" aria-hidden>‚ñæ</span>
      </summary>
      @if (listLoading()) {
        <div class="loading">Cargando...</div>
      } @else {
        <div class="list">
          @for (r of rutas(); track r.id) {
            <div class="item card">
              <div class="row">
                <div class="col">
                  <div class="title">{{ r.nombre }}</div>
                  <div class="subtitle">Actualizada: {{ r.updated_at || '‚Äî' }}</div>
                </div>
                <div class="col small actions">
                  <a class="btn btn-ghost" [routerLink]="['/admin/rutas/editor']" [queryParams]="{ id: r.id }">Editar</a>
                  <button class="btn btn-ghost danger" (click)="eliminar(r.id)" [disabled]="loading()">Eliminar</button>
                </div>
              </div>
            </div>
          }
          @if (rutas().length === 0) {
            <div class="empty">Sin rutas</div>
          }
        </div>
      }
    </details>
  </section>
</div>
